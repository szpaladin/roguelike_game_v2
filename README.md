# Roguelike Game v2.0

一款使用纯 JavaScript + Canvas 开发的 Roguelike 射击游戏。

## 🎮 游戏特性

- **自动战斗**：玩家自动向最近的敌人发射子弹
- **武器系统**：多种基础武器和进化武器，支持武器合成
- **状态效果**：燃烧、冰冻、中毒、致盲等多种效果
- **升级系统**：通过击杀敌人获得经验，升级后获得技能点
- **宝箱系统**：击杀敌人掉落宝箱，获取新武器

## 🚀 快速开始

### 方式一：使用启动脚本
双击 `启动游戏.bat` 即可启动游戏服务器并打开浏览器。

### 方式二：命令行启动
```bash
npm install      # 首次运行需安装依赖
npm run serve    # 启动服务器
```
然后访问 http://localhost:8080/

## 🎯 操作说明

| 按键 | 功能 |
|------|------|
| W/A/S/D | 移动 |
| E | 打开升级菜单（有技能点时） |
| ESC | 关闭菜单 |

## 📁 项目结构

```
js/
├── core/           # 核心模块 (Game, Player, PlayerStats)
├── combat/         # 战斗模块 (Bullet, BulletPool, CollisionManager, AOEHandler)
├── enemies/        # 敌人模块 (Enemy, StatusEffects)
├── weapons/        # 武器模块 (Weapon, WeaponSystem, WeaponsData)
├── effects/        # 视觉特效
├── ui/             # UI 组件
└── chest/          # 宝箱系统
```

## 🧪 运行测试

```bash
npm test
```

## 📋 开发日志

### 2026/1/23
- ✨ **撤离玩法深度增强**：
  - 📡 **撤离点召唤机制**：玩家可消耗1点能源随时发送撤离信号，队友将在5秒后于下方刷新撤离点。
  - 🏮 **全局压力系统 - 视觉衰减**：屏幕亮度随深度平滑变暗，最深处仅保留30%可见度，增加紧张感。
  - 💨 **全局压力系统 - 氧气加速**：氧气消耗不再恒定，随深度指数级加速（4s -> 0.8s每点）。
  - ⚔️ **P2 风险跳跃曲线**：敌人生成频率和死亡惩罚根据深度区间动态调整（300m/500m/800m/1200m）。
  - 🚁 **P3 撤离试炼**：进入撤离区域时触发敌人围攻，围攻规模随深度区间增加（6~30只敌人）。
- 🔧 **交互逻辑优化**：
  - 允许在武器栏满时打开菜单进行撤离召唤（显示「武器栏已满」）。
  - 修正召唤撤离点的垂直偏移，确保其从屏幕底部平滑滚入，避免一闪而过。
  - 死亡弹窗文字改为动态显示当前区域的金币保留比例。
  - 进入新深度区间时红字警告：「光线变暗了……危险更多了……氧气消耗也加快了……」
- 🏗️ **架构重构**：
  - 统一深度区间配置至 `RiskSystem.js`，所有深度相关系统从同一数据源读取。
  - 围攻敌人生成逻辑移至 `EvacuationManager.js`，保持 `Game.js` 简洁。
- 🧪 **自动化测试完善**：
  - 新增 RiskSystem (11)、OxygenSystem (5)、LightingSystem (4)、EvacuationManager (19) 共 39+ 个测试用例。

### 2026/1/21
- ✨ 新增**撤离系统**：搜打撤玩法核心机制
  - 每500米生成撤离点，停留3秒成功撤离
  - 撤离成功保留100%金币，死亡保留50%
  - 创建 `EvacuationManager.js`、`MetaProgress.js`、`EvacuationResultUI.js`
- 🎨 更新武器图标（疾风💨、钢铁🔩、燃霜💠等）
- 🔧 武器进化界面改为图标显示材料
- ⚙️ 氧气消耗速度可配置（当前每4秒扣1血）
- 添加氧气消耗系统，创建 `OxygenSystem.js` 模块
- UI 文本调整：生命值→氧气、经验→充能进度、技能点→能源
- 宝箱功能重构：从"获取新武器"改为"武器进化"

### 2026/1/20
- 添加子弹扩散功能（多武器子弹不再重叠）
- 重构目录结构，创建 `combat/` 模块
- 将 `upgradeAttack()` 改为 `upgradeStrength()`
- 拆分 `CollisionManager`，提取 `AOEHandler`
- 将状态效果应用逻辑移至 `StatusEffects.js`

### 2026/1/18
- 实现宝箱掉落系统（从敌人死亡处掉落）

### 2026/1/17
- 重构状态效果系统，创建 `StatusEffect` 模块
